# -- general -------------------------------------------------------------------

# Do not lose neovim colorscheme plz
set-option -ga terminal-overrides ",xterm-256color:Tc"

setw -g xterm-keys on
set -s escape-time 10                     # faster command sequences
set -sg repeat-time 600                   # increase repeat timeout
set -s focus-events on

set -q -g status-utf8 on                  # expect UTF-8 (tmux < 2.2)
setw -q -g utf8 on

set -g history-limit 5000                 # boost history

# -- display -------------------------------------------------------------------

set -g base-index 1           # start windows numbering at 1
setw -g pane-base-index 1     # make pane numbering consistent with windows

setw -g automatic-rename on   # rename window to reflect current program
set -g renumber-windows on    # renumber windows when a window is closed

set -g set-titles on          # set terminal title

set -g display-panes-time 800 # slightly longer pane indicators display time
set -g display-time 1000      # slightly longer status messages display time

set -g status-interval 10     # redraw status line every 10 seconds

# -- navigation ----------------------------------------------------------------

# toggle mouse
bind m run "cut -c3- ~/.tmux.conf | sh -s _toggle_mouse"


# -- Use only C-W as prefix ----------------------------------------------------
set -gu prefix2
unbind C-a
unbind C-b
set -g prefix C-w
bind C-w send-prefix


# -- send C-w hjkl when vim/neovim ---------------------------------------------
# vim-tmux-navigator
is_vim="ps -o state= -o comm= -t '#{pane_tty}' \
    | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|n?vim?x?)(diff)?$'"

bind 'h' if-shell "$is_vim" 'send-keys C-w h'  'select-pane -L'
bind 'j' if-shell "$is_vim" 'send-keys C-w j'  'select-pane -D'
bind 'k' if-shell "$is_vim" 'send-keys C-w k'  'select-pane -U'
bind 'l' if-shell "$is_vim" 'send-keys C-w l'  'select-pane -R'
bind '\\' if-shell "$is_vim" 'send-keys C-w \\'  'select-pane -l'

bind 'v' if-shell "$is_vim" 'send-keys C-w v'  'split-window -h'
bind 's' if-shell "$is_vim" 'send-keys C-w n'  'split-window -v'
bind 'n' if-shell "$is_vim" 'send-keys C-w n' 'split-window -v'

#bind 'H' if-shell "$is_vim" 'send-keys C-w H'
#bind 'J' if-shell "$is_vim" 'send-keys C-w J' 
#bind 'K' if-shell "$is_vim" 'send-keys C-w K' 
#bind 'L' if-shell "$is_vim" 'send-keys C-w L' 

# -- User defined status messages ------------------------------------------------
# host health
disk_use="#(df --output=pcent -h / | sed '1d;s/[^0-9]//g')"
load_avg="#(cut -d ' ' -f1 /proc/loadavg)"
uptime="#(uptime -p | cut -d ',' -f1)"
host_health="↯ $load_avg | ∫ $disk_use% | ↑ $uptime"

tasks_count="#(graphctl --endpoint=`cat ~/.config/graphene/endpoint` planning | wc -l)"
mails_count="0"
messages="coucou | $mails_count mails | $tasks_count tasks"

# -- Theme (neovim matching duskfox) ---------------------------------------------

icon_box="❐"
icon_circle="●"
icon_up="↑"       # U+2191
icon_down="↓"    # U+2193

color_black="#000000"
color_purple="#27253f"
color_light_purple="#555180"
color_orange="#d3a470"
color_light_blue="#a7e1e7"
color_dark_blue="#5ebdd5"
color_dark_pink="#ce6289"

theme_color_bg_1="$color_purple"
theme_color_fg_1="$color_orange"

# ------ Global
set -g mode-style "fg=$theme_color_fg_1,bg=$theme_color_bg_1"
set -g message-style "fg=$theme_color_fg_1,bg=$theme_color_bg_1"
set -g message-command-style "fg=$theme_color_fg_1,bg=$theme_color_bg_1"
# ------ Pane
set -g pane-border-style "fg=$color_dark_pink"
set -g pane-active-border-style "fg=$color_purple"
#set -g status "on"
#set -g status-justify "left"
# ------- Status bar
set -g status-style "fg=$color_orange,bg=$color_purple"
#set -g status-left-length "100"
#set -g status-right-length "100"
set -g status-left-style NONE
set -g status-right-style NONE
#set -g status-left "#[fg=#2f3239,bg=#5a93aa,bold] #S #[fg=#5a93aa,bg=#0f1c1e,nobold,nounderscore,noitalics]"
#set -g status-left "#[fg=#2f3239,bg=#27253f,bold] #S #[fg=#5a93aa,bg=#27253f,nobold,nounderscore,noitalics]|"
set -g status-left " ❐ #S | $host_health "
set -g status-right "#[fg=$color_dark_pink,bg=$theme_color_bg_1] #{prefix_highlight} #[fg=$color_dark_pink,bg=$theme_color_bbg_1,nobold,nounderscore,noitalics] $messages |#[fg=$color_dark_pink,bg=$color_purple] %Y-%m-%d | %I:%M %p #[fg=#5a93aa,bg=$color_purple,nobold,nounderscore,noitalics]#[fg=$color_orange,bg=$color_purple,bold] | #h "
# ------ Windows status
setw -g window-status-activity-style "underscore,fg=$color_black,bg=$color_purple"
setw -g window-status-separator ""
setw -g window-status-style "NONE,fg=$color_black,bg=$color_purple"
# Format of background windows
setw -g window-status-format "#[fg=$color_dark_blue,bg=$color_purple,nobold,nounderscore,noitalics] [#I] #W #F #[fg=$color_dark_blue,bg=$color_purple,nobold,nounderscore,noitalics]"
# Format of current window  
setw -g window-status-current-format "#[fg=$color_dark_blue,bg=$color_light_purple,nobold,nounderscore,noitalics]#[fg=$color_dark_blue,bg=$color_light_purple,bold] [#I] #W #F #[fg=$color_dark_blue,bg=$color_light_purple,nobold,nounderscore,noitalics]"

