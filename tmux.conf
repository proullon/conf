##### ---------------------------------------------------------------------------
#####  GENERAL
##### ---------------------------------------------------------------------------

set -g default-shell /usr/bin/nu
set -g base-index 1                 # start windows numbering at 1
setw -g pane-base-index 1           # make pane numbering consistent with windows

set -g history-limit 10000
set -sg repeat-time 600
set -s focus-events on

set -ga terminal-overrides ",xterm-256color:Tc"

set -g renumber-windows on          # renumber windows when a window is closed
setw -g automatic-rename on         # rename window to reflect current program
set -g set-titles on

##### ---------------------------------------------------------------------------
#####  PREFIX (C-w)
##### ---------------------------------------------------------------------------

unbind C-b
unbind C-a
set -g prefix C-w

##### ---------------------------------------------------------------------------
#####  NAVIGATION
##### ---------------------------------------------------------------------------

# pane selection
bind -r Up    select-pane -U
bind -r Down  select-pane -D
bind -r Left  select-pane -L
bind -r Right select-pane -R

# quick resize
bind -r M-Up    resize-pane -U 5
bind -r M-Down  resize-pane -D 5
bind -r M-Left  resize-pane -L 5
bind -r M-Right resize-pane -R 5

##### ---------------------------------------------------------------------------
#####  VIM AWARE NAVIGATION
##### ---------------------------------------------------------------------------
# Compatible with official vim-tmux-navigator
# (automatically handle C-h/j/k/l)
set -g @plugin 'christoomey/vim-tmux-navigator'


##### ---------------------------------------------------------------------------
#####  COPY-MODE (VI)
##### ---------------------------------------------------------------------------

setw -g mode-keys vi

bind -T copy-mode-vi Escape send -X cancel
bind -T copy-mode-vi q      send -X cancel

bind -T copy-mode-vi C-u    send -X halfpage-up
bind -T copy-mode-vi C-d    send -X halfpage-down

##### ---------------------------------------------------------------------------
#####  KEYBINDINGS
##### ---------------------------------------------------------------------------

unbind l

bind d detach-client
bind Space next-layout

bind n next-window
bind m previous-window

# Reload config
bind r source-file ~/.tmux.conf \; display "Config reloaded"

##### ---------------------------------------------------------------------------
#####  STATUS-BAR — Rose Pine Moon
##### ---------------------------------------------------------------------------

set -g status-interval 5
set -g @rose_pine_variant 'moon'
set -g @rose_pine_host 'on'
set -g @rose_pine_date_time '%Y-%m-%d %H:%M'
set -g @rose_pine_directory 'on'
set -g @plugin 'rose-pine/tmux'

##### ---------------------------------------------------------------------------
#####  PLUGINS
##### ---------------------------------------------------------------------------

# To update plugin for future revisions or bug fixes, do the "Prefix + U" keycombo

set -g @plugin 'tmux-plugins/tpm'

# Resurrect / Continuum
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @resurrect-strategy-nvim 'session'
set -g @resurrect-strategy-vim  'session'
set -g @resurrect-capture-pane-contents 'on'
set -g @continuum-restore 'on'
set -g @continuum-boot 'off'

##### ---------------------------------------------------------------------------
#####  SMART C-w (Neovim vs tmux)
##### ---------------------------------------------------------------------------

# (n)vim detection in current pane
is_vim='ps --ppid #{pane_pid} -o comm= | tr "\n" " " | grep -iq nvim'

bind-key 'h' 'send-keys C-w h'
bind-key 'j' 'send-keys C-w j'
bind-key 'k' 'send-keys C-w k'
bind-key 'l' 'send-keys C-w l'

##### ---------------------------------------------------------------------------
#####  TPM INIT (always last)
##### ---------------------------------------------------------------------------
run '~/.tmux/plugins/tpm/tpm'

# status-left override
set -g status-left '#{?client_prefix,#[fg=#eb6f92],#[fg=#908caa]} #[fg=white]#S #[default]'
